<div class="detail-page flex flex-col">

  <!-- Header -->
  <div class="flex items-center gap-1">
    <button mat-icon-button (click)="goBack()" matTooltip="Back to authors">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h3 class="m-0 flex-1 leading-none">
      @if (authorDetail()?.author; as author) {
        {{ author.fullName }}
      } @else {
        Author not found
      }
    </h3>
    @if (authorDetail()?.author; as author) {
      <button mat-icon-button (click)="goEdit()" matTooltip="Edit author">
        <mat-icon>edit</mat-icon>
      </button>
      <lib-author-delete-button
        [authorId]="author.authorId"
        [fullName]="author.fullName"
        [iconOnly]="true"
        (deleted)="goBack()" />
    }
  </div>

  <!-- Not found -->
  @if (!authorDetail()?.author) {
    <div class="empty-state flex flex-col items-center text-center">
      <mat-icon>person_off</mat-icon>
      <p>Author not found or the service is unavailable.</p>
      <button mat-stroked-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Back to list
      </button>
    </div>
  }

  <!-- Content -->
  @if (authorDetail()?.author; as author) {

    <!-- Profile fields -->
    <div class="detail-grid">

      <div class="col-span-full">
        <mat-form-field class="w-full" appearance="outline">
          <mat-label>ID</mat-label>
          <mat-icon matPrefix>fingerprint</mat-icon>
          <input matInput [value]="author.authorId" disabled />
        </mat-form-field>
      </div>

      <mat-form-field class="w-full" appearance="fill">
        <mat-label>First name</mat-label>
        <mat-icon matPrefix>badge</mat-icon>
        <input matInput [value]="author.firstName" disabled />
      </mat-form-field>

      <mat-form-field class="w-full" appearance="fill">
        <mat-label>Last name</mat-label>
        <mat-icon matPrefix>badge</mat-icon>
        <input matInput [value]="author.lastName" disabled />
      </mat-form-field>

      <div class="col-span-full">
        <mat-form-field class="w-full" appearance="outline">
          <mat-label>Full name</mat-label>
          <mat-icon matPrefix>person</mat-icon>
          <input matInput [value]="author.fullName" disabled />
        </mat-form-field>
      </div>

      <mat-form-field class="w-full" appearance="fill">
        <mat-label>Date of birth</mat-label>
        <mat-icon matPrefix>cake</mat-icon>
        <input matInput [value]="author.dateOfBirth | date:'mediumDate'" disabled />
      </mat-form-field>

      <mat-form-field class="w-full" appearance="fill">
        <mat-label>Date of death</mat-label>
        <mat-icon matPrefix>event_busy</mat-icon>
        <input matInput [value]="author.dateOfDeath ? (author.dateOfDeath | date:'mediumDate') : '\u2014'" disabled />
      </mat-form-field>

      <mat-form-field class="w-full" appearance="fill" floatLabel="always">
        <mat-label>Literary genre</mat-label>
        <mat-icon matPrefix>category</mat-icon>
        <mat-select [ngModel]="author.literaryGenreId" disabled>
          <mat-option [value]="author.literaryGenreId">{{ author.literaryGenreName }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="w-full" appearance="outline">
        <mat-label>Age</mat-label>
        <mat-icon matPrefix>timelapse</mat-icon>
        <input matInput [value]="author.age" disabled />
      </mat-form-field>

      <mat-form-field class="w-full" appearance="outline">
        <mat-label>Is deceased</mat-label>
        @if (author.isDeceased) {
          <mat-icon matPrefix>church</mat-icon>
        } @else {
          <mat-icon matPrefix>sentiment_very_satisfied</mat-icon>
        }
        <input matInput [value]="author.isDeceased ? 'Deceased' : 'Alive'" disabled />
      </mat-form-field>

    </div>

    <mat-divider></mat-divider>

    <!-- Related entities tabs -->
    <mat-tab-group animationDuration="200ms" class="detail-tabs">

      <!-- Awards -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">emoji_events</mat-icon>
          Awards
          @if (authorDetail()!.awards.length) {
            <span class="tab-badge">{{ authorDetail()!.awards.length }}</span>
          }
        </ng-template>

        <mat-accordion multi>
          @if (!authorDetail()!.awards.length) {
            <p class="text-center">No awards registered.</p>
          }
          @for (award of authorDetail()!.awards; track award.awardId) {
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>emoji_events</mat-icon>
                  {{ award.title }}
                </mat-panel-title>
                <mat-panel-description>
                  {{ award.awardedOn | date:'mediumDate' }}
                </mat-panel-description>
              </mat-expansion-panel-header>
              <div class="detail-grid">
                <div class="col-span-full">
                  <mat-form-field class="w-full" appearance="fill">
                    <mat-label>Title</mat-label>
                    <mat-icon matPrefix>emoji_events</mat-icon>
                    <input matInput [value]="award.title" disabled />
                  </mat-form-field>
                </div>
                <mat-form-field class="w-full" appearance="fill">
                  <mat-label>Awarded on</mat-label>
                  <mat-icon matPrefix>calendar_today</mat-icon>
                  <input matInput [value]="award.awardedOn | date:'mediumDate'" disabled />
                </mat-form-field>
              </div>
            </mat-expansion-panel>
          }
        </mat-accordion>
      </mat-tab>

      <!-- Papers -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">article</mat-icon>
          Papers
          @if (authorDetail()!.papers.length) {
            <span class="tab-badge">{{ authorDetail()!.papers.length }}</span>
          }
        </ng-template>

        <mat-accordion multi>
          @if (!authorDetail()!.papers.length) {
            <p class="text-center">No papers registered.</p>
          }
          @for (paper of authorDetail()!.papers; track paper.paperId) {
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>article</mat-icon>
                  {{ paper.title }}
                </mat-panel-title>
                <mat-panel-description>
                  {{ paper.publishedOn | date:'mediumDate' }}
                </mat-panel-description>
              </mat-expansion-panel-header>
              <div class="detail-grid">
                <div class="col-span-full">
                  <mat-form-field class="w-full" appearance="fill">
                    <mat-label>Title</mat-label>
                    <mat-icon matPrefix>article</mat-icon>
                    <input matInput [value]="paper.title" disabled />
                  </mat-form-field>
                </div>
                <mat-form-field class="w-full" appearance="fill">
                  <mat-label>Published on</mat-label>
                  <mat-icon matPrefix>calendar_today</mat-icon>
                  <input matInput [value]="paper.publishedOn | date:'mediumDate'" disabled />
                </mat-form-field>
                @if (paper.url) {
                  <mat-form-field class="w-full" appearance="fill">
                    <mat-label>URL</mat-label>
                    <mat-icon matPrefix>link</mat-icon>
                    <input matInput [value]="paper.url" disabled />
                    <a matSuffix [href]="paper.url" target="_blank" rel="noopener" mat-icon-button>
                      <mat-icon>open_in_new</mat-icon>
                    </a>
                  </mat-form-field>
                }
              </div>
            </mat-expansion-panel>
          }
        </mat-accordion>
      </mat-tab>

      <!-- Affiliations -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">business</mat-icon>
          Affiliations
          @if (authorDetail()!.affiliations.length) {
            <span class="tab-badge">{{ authorDetail()!.affiliations.length }}</span>
          }
        </ng-template>

        <mat-accordion multi>
          @if (!authorDetail()!.affiliations.length) {
            <p class="text-center">No affiliations registered.</p>
          }
          @for (aff of authorDetail()!.affiliations; track aff.affiliationId) {
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>business</mat-icon>
                  {{ aff.institutionName }}
                </mat-panel-title>
                <mat-panel-description>
                  {{ aff.startDate | date:'mediumDate' }} â€” {{ aff.endDate ? (aff.endDate | date:'mediumDate') : 'Present' }}
                </mat-panel-description>
              </mat-expansion-panel-header>
              <div class="detail-grid">
                <div class="col-span-full">
                  <mat-form-field class="w-full" appearance="fill">
                    <mat-label>Institution</mat-label>
                    <mat-icon matPrefix>business</mat-icon>
                    <input matInput [value]="aff.institutionName" disabled />
                  </mat-form-field>
                </div>
                <mat-form-field class="w-full" appearance="fill">
                  <mat-label>Start date</mat-label>
                  <mat-icon matPrefix>event</mat-icon>
                  <input matInput [value]="aff.startDate | date:'mediumDate'" disabled />
                </mat-form-field>
                <mat-form-field class="w-full" appearance="fill">
                  <mat-label>End date</mat-label>
                  <mat-icon matPrefix>event_busy</mat-icon>
                  <input matInput [value]="aff.endDate ? (aff.endDate | date:'mediumDate') : 'Present'" disabled />
                </mat-form-field>
              </div>
            </mat-expansion-panel>
          }
        </mat-accordion>
      </mat-tab>

    </mat-tab-group>
  }

</div>
