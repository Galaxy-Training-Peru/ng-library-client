<h4>List of authors</h4>

<div class="list-container">

  <div class="list-filters">
    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Search authors</mat-label>
      <input #searchInput matInput placeholder="Type a name, genre, etc."
             [value]="vm.searchText() ?? ''"
             (input)="onSearchInput(searchInput.value)" />
      @if (searchInput.value.length) {
        <button mat-icon-button matSuffix (click)="onSearchClear(searchInput)" aria-label="Clear">
          <mat-icon>close</mat-icon>
        </button>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Literary Genre</mat-label>
      <mat-select [ngModel]="vm.selectedLiteraryGenreId()"
                  (ngModelChange)="onLiteraryGenreChange($event)">
        <mat-option [value]="undefined">All</mat-option>
        @for (genre of vm.literaryGenres(); track genre.literaryGenreId) {
          <mat-option [value]="genre.literaryGenreId">{{ genre.name }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <div class="list-table-container">
    <table mat-table [dataSource]="vm.authors()"
           matSort
           [matSortActive]="vm.activeSortField()"
           [matSortDirection]="vm.activeSortDirection()"
           (matSortChange)="onSortChange($event)">

      <ng-container matColumnDef="authorId">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let author">{{ author.authorId }}</td>
      </ng-container>

      <ng-container matColumnDef="fullName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Full Name</th>
        <td mat-cell *matCellDef="let author">{{ author.fullName }}</td>
      </ng-container>

      <ng-container matColumnDef="dateOfBirth">
        <th mat-header-cell *matHeaderCellDef>Date of Birth</th>
        <td mat-cell *matCellDef="let author">{{ author.dateOfBirth | date }}</td>
      </ng-container>

      <ng-container matColumnDef="dateOfDeath">
        <th mat-header-cell *matHeaderCellDef>Date of Death</th>
        <td mat-cell *matCellDef="let author">{{ author.dateOfDeath ? (author.dateOfDeath | date) : '-' }}</td>
      </ng-container>

      <ng-container matColumnDef="age">
        <th mat-header-cell *matHeaderCellDef>Age</th>
        <td mat-cell *matCellDef="let author">{{ author.age }}</td>
      </ng-container>

      <ng-container matColumnDef="literaryGenre">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Literary Genre</th>
        <td mat-cell *matCellDef="let author">{{ author.literaryGenreName }}</td>
      </ng-container>

      <ng-container matColumnDef="isDeceased">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Is Deceased</th>
        <td mat-cell *matCellDef="let author">
          <mat-icon [matTooltip]="author.isDeceased ? 'Yes' : 'No'"
                    [fontIcon]="author.isDeceased ? 'church' : 'sentiment_very_satisfied'">
          </mat-icon>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let row" class="actions-cell">
          <div class="row-actions">
            <button mat-icon-button matTooltip="View detail" (click)="onViewDetail(row.authorId)">
              <mat-icon>visibility</mat-icon>
            </button>
            <button mat-icon-button matTooltip="Edit" (click)="onEditAuthor(row.authorId)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" matTooltip="Delete">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>
  </div>

  <div class="list-accordion-container">
    <mat-accordion class="list-accordion" multi>
      @for (a of vm.authors(); track a.authorId) {
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>{{ a.fullName }}</mat-panel-title>
            <mat-panel-description class="panel-actions">
              {{ a.literaryGenreName }}
              <span class="spacer"></span>
              <button mat-icon-button aria-label="View detail" (click)="onViewDetail(a.authorId); $event.stopPropagation()">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button aria-label="Edit" (click)="onEditAuthor(a.authorId); $event.stopPropagation()">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button aria-label="Delete" (click)="$event.stopPropagation()">
                <mat-icon>delete</mat-icon>
              </button>
            </mat-panel-description>
          </mat-expansion-panel-header>

          <div class="field"><strong>ID:</strong> {{ a.authorId }}</div>
          <div class="field"><strong>Date of Birth:</strong> {{ a.dateOfBirth | date }}</div>
          <div class="field"><strong>Date of Death:</strong> {{ a.dateOfDeath ? (a.dateOfDeath | date) : '-' }}</div>
          <div class="field"><strong>Age:</strong> {{ a.age }}</div>
          <div class="field"><strong>Is Deceased:</strong>
            &nbsp;<mat-icon [fontIcon]="a.isDeceased ? 'church' : 'sentiment_very_satisfied'" class="mobile-icon"></mat-icon>
          </div>

          <mat-action-row>
            <button mat-stroked-button (click)="onViewDetail(a.authorId)">
              <mat-icon>visibility</mat-icon>
              View
            </button>
            <button mat-stroked-button (click)="onEditAuthor(a.authorId)">
              <mat-icon>edit</mat-icon>
              Edit
            </button>
            <button mat-stroked-button color="warn">
              <mat-icon>delete</mat-icon>
              Delete
            </button>
          </mat-action-row>
        </mat-expansion-panel>
      }
    </mat-accordion>
  </div>

  <mat-paginator [length]="vm.totalCount()"
                 [pageSize]="vm.pageSize()"
                 [pageIndex]="vm.currentPage()"
                 [pageSizeOptions]="[5, 10, 15, 20]"
                 (page)="onPageChange($event)"
                 showFirstLastButtons>
  </mat-paginator>
</div>
